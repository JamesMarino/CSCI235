SQL> SET LINESIZE 300
SQL> /*
 * Task 2
 */
SQL> -- Question 2.1
SQL> -- Need to disable the constraint
SQL> ALTER TABLE TEACHES
  DISABLE CONSTRAINT RUNNINGSUBJECT_FKEY2;

Table TEACHES altered.

SQL> DELETE FROM ACADEMIC WHERE ACADEMIC.STAFF# NOT IN (
  SELECT DISTINCT TEACHES.LECTURER FROM TEACHES
    WHERE TEACHES.YEAR > TO_CHAR(ADD_MONTHS(SYSDATE, -12 * 3), 'YYYY')
  );

1 row deleted.

SQL> -- Question 2.2
SQL> CREATE TABLE CSCI235 AS (SELECT * FROM ACADEMIC WHERE 1=0);

Table CSCI235 created.

SQL> SELECT * FROM CSCI235;

no rows selected


SQL> ALTER TABLE CSCI235 ADD (  
	CONSTRAINT CSCI235_pkey PRIMARY KEY(staff#),
	CONSTRAINT CSCI235_ckey1 UNIQUE (first_name, last_name),
	CONSTRAINT CSCI235_ckey2 UNIQUE(email),
	CONSTRAINT CSCI235_ckey3 UNIQUE(bldg#, room#),
	CONSTRAINT CSCI235_ckey4 UNIQUE(phone#),
	CONSTRAINT CSCI235_fkey4 FOREIGN KEY (position)
				REFERENCES LPosition(position));

Table CSCI235 altered.

SQL> INSERT INTO CSCI235 (
  SELECT * FROM ACADEMIC WHERE ACADEMIC.STAFF# IN (
    SELECT LECTURER FROM TEACHES WHERE TEACHES.CODE = 'CSCI235'
  )
);

5 rows inserted.

SQL> -- Question 2.3
SQL> ALTER TABLE ACADEMIC ADD TOTAL_SUBJECTS NUMBER(10);

Table ACADEMIC altered.

SQL> UPDATE ACADEMIC A1 SET TOTAL_SUBJECTS = (SELECT COUNT(TEACHES.CODE) FROM TEACHES WHERE TEACHES.LECTURER = A1.STAFF#);

11 rows updated.

SQL> SPOOL OFF;
